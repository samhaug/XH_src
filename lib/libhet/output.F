

C$**********************************************************************
      SUBROUTINE OUTPUT(LU,ITAPER)
      save
      COMMON/TAPE/ IB(1401),FILL(113)
      DIMENSION B(536),INSTR(5),IADATE(3),IATIME(3),ISL(2),IDIP(2),
     1IAZ(3),ISTR(2),IPL(3),YMD(6)
      EQUIVALENCE (IB(1),B(1))
      COMMON/DBLEC/ EPLA,EPLON,DEP,TORG,DURT
      COMMON/DBLEM/ XMD(6),R0D
      COMMON/OUTPAR/ ERRLA,ERRLO,ERRDEP,ERRTIM,
     1ERRMOM(6),SCALAR,STRIKE(2),DIP(2),SLIP(2),
     2EIVL(3),PLUNG(3),AZIM(3)
      DATA INSTR/4HSRO ,4HASRO,4HIDA ,4HDWWS,4HRSTN/
      NSOUR=1
      CALL REWFL(7)
      CALL BFFIN(7,1,B,1,J,M)
      CALL BFFIN(7,1,B,13,J,M)
    1 CALL BFFIN(7,1,B,1401,J,M)
      IF(J.EQ.3) GO TO 10
      IF(IB(22).NE.0) GO TO 1
      CALL STATN(IB(1),NAME,IB(3),STLAT,STLONG,ILEV)
      IFMT=2
      CUTOFF=45.
      IF(ITAPER.EQ.2) CUTOFF=32.
      IF(B(4).GT.20.) CUTOFF=135.
      T0=FLOAT(IB(16)+IB(17)-1)*B(4)
      TL=FLOAT(IB(18)-IB(17))*B(4)
      IN=IB(3)
      WRITE(LU,1000) IFMT,NAME,IB(1),INSTR(IN),IB(2),STLAT,STLONG,
     1ILEV,B(19),B(20),B(21),CUTOFF,T0,TL
 1000 FORMAT(I1,2X,A4,I4,1X,A4,I2,F7.2,F8.2,I5,F7.2,3F6.1,2F8.1)
      GO TO 1
   10 CONTINUE
#if ( defined(MachineS) )
      CALL IDATE(IADATE(2),IADATE(1),IADATE(3))
#else
      CALL IDATE(IADATE)
#endif
      IADATE(3)=MOD(IADATE(3),1900)
      CALL ITIME(IATIME)
      IFMT=3
      N=1
      WRITE(LU,1001) IFMT,NSOUR,N,EPLA,ERRLA,EPLON,ERRLO,
     1DEP,ERRDEP,TORG,ERRTIM,DURT,IADATE(2),
     2IADATE(1),IADATE(3),(IATIME(I),I=1,3)
 1001 FORMAT(I1,2X,2I1,F7.2,F6.2,F8.2,F6.2,5F6.1,1X,
     12(I2,1H/),I2,1H,,2(I2,1H:),I2)
      AMAX=0.
      DO 21 I=1,6
   21 AMAX=AMAX1(ABS(XMD(I)),AMAX)
      DO 22 I=1,8
      X=10.**(I-1)
      IF(AMAX*X.LT.1.) GO TO 22
      XNORM=X
      IEXP=31-I
      GO TO 23
   22 CONTINUE
      STOP 'EXPONENT OUT OF RANGE'
   23 DO 24 I=1,6
      YMD(I)=XMD(I)*XNORM
   24 ERRMOM(I)=ERRMOM(I)*XNORM
      IFMT=4
      WRITE(LU,1002) IFMT,NSOUR,N,IEXP,(YMD(I),ERRMOM(I),I=1,6)
 1002 FORMAT(I1,2X,2I1,I3,6(F7.3,F5.3))
      IFMT=5
      DO 25 I=1,3
      IPL(I)=PLUNG(I)+.499
      EIVL(I)=EIVL(I)*XNORM
   25 IAZ(I)=AMOD(AZIM(I)+.499,360.)
      SCALAR=SCALAR*XNORM
      DO 26 I=1,2
      IDIP(I)=DIP(I)+.499
      ISL(I)=SLIP(I)+SIGN(0.499,SLIP(I))
      IF(ISL(I).LT.-180) ISL(I)=360+ISL(I)
      IF(ISL(I).GT.180) ISL(I)=ISL(I)-360
   26 ISTR(I)=AMOD(STRIKE(I)+.499,360.)
      WRITE(LU,1003) IFMT,NSOUR,N,(EIVL(I),IPL(I),IAZ(I),I=1,3),
     1SCALAR,(ISTR(I),IDIP(I),ISL(I),I=1,2)
 1003 FORMAT(I1,2X,2I1,3(F7.2,I3,I4),F6.2,2(I4,I3,I5))
      CALL REWFL(7)
      RETURN
      END
